import React, { useState } from 'react';
import { Calendar, Heart, Info, BookOpen, Gift, Coffee, Thermometer, Activity, Moon, Flower2, Sun, CloudRain } from 'lucide-react';

export default function CycleCompanion() {
  const [currentDate, setCurrentDate] = useState(new Date());
  const [cycleData, setCycleData] = useState({});
  const [activeTab, setActiveTab] = useState('calendar');
  const [cycleLength, setCycleLength] = useState(28);
  const [periodLength, setPeriodLength] = useState(5);

  // Calculate cycle phases
  const calculatePhase = (dayOfCycle) => {
    if (dayOfCycle <= periodLength) return 'menstrual';
    if (dayOfCycle <= 13) return 'follicular';
    if (dayOfCycle >= 14 && dayOfCycle <= 16) return 'ovulation';
    return 'luteal';
  };

  // Add or remove period start date
  const togglePeriodStart = (date) => {
    const key = date.toDateString();
    setCycleData(prev => {
      const newData = { ...prev };
      if (newData[key] && newData[key].type === 'period_start') {
        // Remove period start
        delete newData[key];
      } else {
        // Add period start
        newData[key] = { type: 'period_start', phase: 'menstrual' };
      }
      return newData;
    });
  };

  // Get phase for a specific date based on cycle data
  const getDatePhase = (date) => {
    const dateStr = date.toDateString();
    if (cycleData[dateStr]) return cycleData[dateStr];

    // Find the most recent period start
    let lastPeriodStart = null;
    Object.keys(cycleData).forEach(key => {
      const cycleDate = new Date(key);
      if (cycleData[key].type === 'period_start' && cycleDate <= date) {
        if (!lastPeriodStart || cycleDate > new Date(lastPeriodStart)) {
          lastPeriodStart = key;
        }
      }
    });

    if (lastPeriodStart) {
      const daysDiff = Math.floor((date - new Date(lastPeriodStart)) / (1000 * 60 * 60 * 24)) + 1;
      const phase = calculatePhase(daysDiff);
      return { phase, dayOfCycle: daysDiff };
    }

    return null;
  };

  // Calendar generation
  const generateCalendar = () => {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const firstDay = new Date(year, month, 1);
    const startDate = new Date(firstDay);
    startDate.setDate(startDate.getDate() - firstDay.getDay());

    const calendar = [];
    const current = new Date(startDate);

    for (let week = 0; week < 6; week++) {
      const weekDays = [];
      for (let day = 0; day < 7; day++) {
        weekDays.push(new Date(current));
        current.setDate(current.getDate() + 1);
      }
      calendar.push(weekDays);
    }

    return calendar;
  };

  const phaseColors = {
    menstrual: 'bg-red-100 border-red-300 text-red-800',
    follicular: 'bg-green-100 border-green-300 text-green-800',
    ovulation: 'bg-yellow-100 border-yellow-300 text-yellow-800',
    luteal: 'bg-purple-100 border-purple-300 text-purple-800'
  };

  const phaseIcons = {
    menstrual: CloudRain,
    follicular: Flower2,
    ovulation: Sun,
    luteal: Moon
  };

  const cycleInfo = {
    menstrual: {
      title: "Menstrual Phase (Days 1-5)",
      description: "The period begins. Hormone levels are low, and the uterine lining sheds.",
      symptoms: ["Cramping", "Fatigue", "Mood changes", "Lower back pain", "Headaches"],
      support: [
        "Offer heating pads or warm baths for cramps",
        "Prepare her favorite comfort foods",
        "Be extra patient and understanding",
        "Help with household tasks",
        "Suggest gentle activities like yoga or walks"
      ]
    },
    follicular: {
      title: "Follicular Phase (Days 1-13)",
      description: "Overlaps with menstruation. Estrogen rises, energy typically increases.",
      symptoms: ["Increasing energy", "Better mood", "Clearer skin", "Improved focus"],
      support: [
        "Plan active dates or workouts together",
        "This is a great time for important conversations",
        "Support her goals and new projects",
        "Celebrate her increased energy and positivity"
      ]
    },
    ovulation: {
      title: "Ovulation Phase (Days 14-16)",
      description: "Peak fertility window. Estrogen peaks, then drops. LH surge triggers egg release.",
      symptoms: ["Higher libido", "Increased energy", "Heightened senses", "Slight temp rise"],
      support: [
        "Be attentive to her increased social energy",
        "Plan special dates or romantic activities",
        "Be aware she may feel more confident and outgoing",
        "Support any fertility goals if applicable"
      ]
    },
    luteal: {
      title: "Luteal Phase (Days 17-28)",
      description: "After ovulation. Progesterone rises then falls if no pregnancy occurs.",
      symptoms: ["PMS symptoms", "Mood swings", "Bloating", "Breast tenderness", "Food cravings"],
      support: [
        "Stock up on her favorite snacks",
        "Be extra patient with mood changes",
        "Offer massages for physical discomfort",
        "Plan low-key, cozy activities",
        "Give extra emotional support and reassurance"
      ]
    }
  };

  const calendar = generateCalendar();
  const today = new Date();

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50">
      <div className="container mx-auto px-4 py-8">
        {/* Header */}
        <div className="text-center mb-8">
          <div className="flex items-center justify-center gap-3 mb-4">
            <Heart className="w-8 h-8 text-pink-500" />
            <h1 className="text-4xl font-bold bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent">
              Cycle Companion
            </h1>
            <Heart className="w-8 h-8 text-pink-500" />
          </div>
          <p className="text-gray-600 text-lg">Supporting your partner through every phase</p>
        </div>

        {/* Settings */}
        <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
          <h3 className="text-lg font-semibold mb-4 flex items-center gap-2">
            <Activity className="w-5 h-5" />
            Cycle Settings
          </h3>
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Average Cycle Length (days)
              </label>
              <input
                type="number"
                value={cycleLength}
                onChange={(e) => setCycleLength(Number(e.target.value))}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                min="21"
                max="35"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Period Length (days)
              </label>
              <input
                type="number"
                value={periodLength}
                onChange={(e) => setPeriodLength(Number(e.target.value))}
                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                min="3"
                max="7"
              />
            </div>
          </div>
        </div>

        {/* Navigation Tabs */}
        <div className="flex flex-wrap gap-2 mb-8 bg-white rounded-xl p-2 shadow-lg">
          <button
            onClick={() => setActiveTab('calendar')}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${
              activeTab === 'calendar'
                ? 'bg-pink-500 text-white shadow-md'
                : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            <Calendar className="w-4 h-4" />
            Calendar
          </button>
          <button
            onClick={() => setActiveTab('phases')}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${
              activeTab === 'phases'
                ? 'bg-pink-500 text-white shadow-md'
                : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            <Info className="w-4 h-4" />
            Cycle Phases
          </button>
          <button
            onClick={() => setActiveTab('tips')}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${
              activeTab === 'tips'
                ? 'bg-pink-500 text-white shadow-md'
                : 'text-gray-600 hover:bg-gray-100'
            }`}
          >
            <Gift className="w-4 h-4" />
            Support Tips
          </button>
        </div>

        {/* Calendar Tab */}
        {activeTab === 'calendar' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            {/* Instructions */}
            <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
              <h3 className="font-semibold text-blue-800 mb-2">üìã How to Use</h3>
              <p className="text-blue-700 text-sm">
                <strong>Click any date</strong> to mark it as a period start date. Click again to remove it. 
                Period start dates are marked with a red "P" badge and automatically calculate the cycle phases.
              </p>
            </div>

            {/* Calendar Header */}
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-800">
                {currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
              </h2>
              <div className="flex gap-2">
                <button
                  onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1))}
                  className="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                >
                  ‚Üê
                </button>
                <button
                  onClick={() => setCurrentDate(new Date())}
                  className="px-3 py-1 bg-pink-100 hover:bg-pink-200 text-pink-700 rounded-lg transition-colors"
                >
                  Today
                </button>
                <button
                  onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1))}
                  className="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
                >
                  ‚Üí
                </button>
              </div>
            </div>

            {/* Calendar Grid */}
            <div className="grid grid-cols-7 gap-2 mb-4">
              {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                <div key={day} className="text-center font-semibold text-gray-600 py-2">
                  {day}
                </div>
              ))}
            </div>

            <div className="grid grid-cols-7 gap-2">
              {calendar.flat().map((date, index) => {
                const isToday = date.toDateString() === today.toDateString();
                const isCurrentMonth = date.getMonth() === currentDate.getMonth();
                const phaseData = getDatePhase(date);
                const phaseColor = phaseData ? phaseColors[phaseData.phase] : '';

                return (
                  <div
                    key={index}
                    onClick={() => togglePeriodStart(date)}
                    className={`
                      relative h-12 flex items-center justify-center cursor-pointer rounded-lg border-2 transition-all hover:scale-105
                      ${isCurrentMonth ? 'text-gray-800' : 'text-gray-400'}
                      ${isToday ? 'ring-2 ring-pink-500 ring-offset-1' : ''}
                      ${phaseColor || 'border-gray-200 hover:border-pink-300'}
                      ${cycleData[date.toDateString()]?.type === 'period_start' ? 'ring-2 ring-red-400 ring-offset-1' : ''}
                    `}
                  >
                    <span className="font-medium">{date.getDate()}</span>
                    {cycleData[date.toDateString()]?.type === 'period_start' && (
                      <div className="absolute top-1 right-1">
                        <div className="w-3 h-3 bg-red-500 rounded-full flex items-center justify-center">
                          <span className="text-white text-xs font-bold">P</span>
                        </div>
                      </div>
                    )}
                    {phaseData && (
                      <div className="absolute bottom-1 left-1/2 transform -translate-x-1/2">
                        <div className="w-2 h-2 bg-current rounded-full opacity-60"></div>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>

            {/* Legend */}
            <div className="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4">
              {Object.entries(phaseColors).map(([phase, color]) => {
                const Icon = phaseIcons[phase];
                return (
                  <div key={phase} className={`flex items-center gap-2 p-3 rounded-lg ${color}`}>
                    <Icon className="w-4 h-4" />
                    <span className="text-sm font-medium capitalize">{phase}</span>
                  </div>
                );
              })}
            </div>
          </div>
        )}

        {/* Phases Tab */}
        {activeTab === 'phases' && (
          <div className="space-y-6">
            {Object.entries(cycleInfo).map(([phase, info]) => {
              const Icon = phaseIcons[phase];
              return (
                <div key={phase} className="bg-white rounded-xl shadow-lg p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <div className={`p-2 rounded-lg ${phaseColors[phase]}`}>
                      <Icon className="w-6 h-6" />
                    </div>
                    <h3 className="text-xl font-bold text-gray-800">{info.title}</h3>
                  </div>
                  
                  <p className="text-gray-600 mb-4">{info.description}</p>
                  
                  <div className="grid md:grid-cols-2 gap-6">
                    <div>
                      <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                        <Thermometer className="w-4 h-4" />
                        Common Symptoms
                      </h4>
                      <ul className="space-y-2">
                        {info.symptoms.map((symptom, index) => (
                          <li key={index} className="flex items-center gap-2 text-gray-600">
                            <div className="w-2 h-2 bg-gray-400 rounded-full"></div>
                            {symptom}
                          </li>
                        ))}
                      </ul>
                    </div>
                    
                    <div>
                      <h4 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                        <Heart className="w-4 h-4" />
                        How to Support Her
                      </h4>
                      <ul className="space-y-2">
                        {info.support.map((tip, index) => (
                          <li key={index} className="flex items-start gap-2 text-gray-600">
                            <div className="w-2 h-2 bg-pink-400 rounded-full mt-2 flex-shrink-0"></div>
                            {tip}
                          </li>
                        ))}
                      </ul>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}

        {/* Tips Tab */}
        {activeTab === 'tips' && (
          <div className="bg-white rounded-xl shadow-lg p-6">
            <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
              <BookOpen className="w-6 h-6 text-pink-500" />
              General Support Tips
            </h2>
            
            <div className="grid md:grid-cols-2 gap-8">
              <div>
                <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                  <Coffee className="w-5 h-5 text-orange-500" />
                  Daily Essentials
                </h3>
                <ul className="space-y-3">
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-orange-400 rounded-full mt-2"></div>
                    <span>Keep track of her preferences for pain relief (heat, medication, massage)</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-orange-400 rounded-full mt-2"></div>
                    <span>Stock up on her favorite comfort foods and snacks</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-orange-400 rounded-full mt-2"></div>
                    <span>Have heating pads, pain relievers, and period products readily available</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-orange-400 rounded-full mt-2"></div>
                    <span>Offer to handle more household tasks during difficult days</span>
                  </li>
                </ul>
              </div>
              
              <div>
                <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                  <Heart className="w-5 h-5 text-pink-500" />
                  Emotional Support
                </h3>
                <ul className="space-y-3">
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-pink-400 rounded-full mt-2"></div>
                    <span>Listen without trying to "fix" everything</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-pink-400 rounded-full mt-2"></div>
                    <span>Validate her feelings and experiences</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-pink-400 rounded-full mt-2"></div>
                    <span>Be patient with mood changes - they're temporary</span>
                  </li>
                  <li className="flex items-start gap-3">
                    <div className="w-2 h-2 bg-pink-400 rounded-full mt-2"></div>
                    <span>Show extra affection and appreciation</span>
                  </li>
                </ul>
              </div>
            </div>
            
            <div className="mt-8 p-4 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg border border-pink-200">
              <h4 className="font-semibold text-gray-800 mb-2">üí° Pro Tip</h4>
              <p className="text-gray-600">
                Every person's cycle is unique. Pay attention to her individual patterns and preferences. 
                Communication is key - ask what she needs and how you can best support her during each phase.
              </p>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
