<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cycle Companion</title>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.12.4/babel.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Storage utility functions
        const storage = {
            // In-memory storage for Claude.ai environment
            data: {},
            
            get: function(key) {
                // For production, replace with: return localStorage.getItem(key);
                return this.data[key] || null;
            },
            
            set: function(key, value) {
                // For production, replace with: localStorage.setItem(key, value);
                this.data[key] = value;
            },
            
            remove: function(key) {
                // For production, replace with: localStorage.removeItem(key);
                delete this.data[key];
            }
        };

        // Data management functions
        const saveData = (data) => {
            try {
                storage.set('cycleData', JSON.stringify(data));
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
            }
        };

        const loadData = () => {
            try {
                const saved = storage.get('cycleData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    console.log('Data loaded successfully');
                    return parsed;
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
            
            // Return default data if nothing saved or error occurred
            return {
                lastPeriodStart: null,
                cycleLength: 28,
                periodLength: 5,
                periodHistory: [], // Track multiple periods for better predictions
                notes: {} // Store notes for specific dates
            };
        };

        // Simple SVG icons
        const Calendar = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const Heart = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
        );

        const Info = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
        );

        const Plus = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Settings = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V6a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        );

        const Save = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <polyline points="17,21 17,13 7,13 7,21"/>
                <polyline points="7,3 7,8 15,8"/>
            </svg>
        );

        const CycleCompanion = () => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [cycleData, setCycleData] = useState(loadData());
            const [selectedDate, setSelectedDate] = useState(null);
            const [activeTab, setActiveTab] = useState('calendar');
            const [noteText, setNoteText] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [tempSettings, setTempSettings] = useState({
                cycleLength: cycleData.cycleLength,
                periodLength: cycleData.periodLength
            });

            // Load data on component mount
            useEffect(() => {
                const data = loadData();
                setCycleData(data);
                setTempSettings({
                    cycleLength: data.cycleLength,
                    periodLength: data.periodLength
                });
            }, []);

            // Auto-save data whenever cycleData changes
            useEffect(() => {
                saveData(cycleData);
            }, [cycleData]);

            // Load note when selecting a date
            useEffect(() => {
                if (selectedDate) {
                    const dateKey = selectedDate.toISOString().split('T')[0];
                    setNoteText(cycleData.notes[dateKey] || '');
                }
            }, [selectedDate, cycleData.notes]);

            const getCycleInfo = (date) => {
                if (!cycleData.lastPeriodStart) return null;
                
                const daysSinceLastPeriod = Math.floor((date - new Date(cycleData.lastPeriodStart)) / (1000 * 60 * 60 * 24));
                const cycleDay = ((daysSinceLastPeriod % cycleData.cycleLength) + cycleData.cycleLength) % cycleData.cycleLength + 1;
                
                let phase, color;
                
                if (cycleDay <= cycleData.periodLength) {
                    phase = 'Menstrual';
                    color = 'bg-red-500';
                } else if (cycleDay <= 13) {
                    phase = 'Follicular';
                    color = 'bg-green-500';
                } else if (cycleDay <= 16) {
                    phase = 'Ovulation';
                    color = 'bg-purple-500';
                } else {
                    phase = 'Luteal';
                    color = 'bg-blue-500';
                }
                
                return { phase, color, cycleDay };
            };

            const generateCalendarDays = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();
                
                const days = [];
                
                for (let i = 0; i < startingDayOfWeek; i++) {
                    days.push(null);
                }
                
                for (let day = 1; day <= daysInMonth; day++) {
                    days.push(new Date(year, month, day));
                }
                
                return days;
            };

            const formatDate = (date) => {
                return date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            };

            const setPeriodStart = (date) => {
                const newPeriodStart = date.toISOString();
                setCycleData(prev => ({
                    ...prev,
                    lastPeriodStart: newPeriodStart,
                    periodHistory: [...(prev.periodHistory || []), newPeriodStart].slice(-12) // Keep last 12 periods
                }));
            };

            const saveNote = () => {
                if (selectedDate) {
                    const dateKey = selectedDate.toISOString().split('T')[0];
                    setCycleData(prev => ({
                        ...prev,
                        notes: {
                            ...prev.notes,
                            [dateKey]: noteText.trim()
                        }
                    }));
                    
                    // Remove empty notes
                    if (!noteText.trim()) {
                        setCycleData(prev => {
                            const newNotes = { ...prev.notes };
                            delete newNotes[dateKey];
                            return { ...prev, notes: newNotes };
                        });
                    }
                }
            };

            const saveSettings = () => {
                setCycleData(prev => ({
                    ...prev,
                    cycleLength: tempSettings.cycleLength,
                    periodLength: tempSettings.periodLength
                }));
                setShowSettings(false);
            };

            const exportData = () => {
                const dataStr = JSON.stringify(cycleData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `cycle-data-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            };

            const calendarDays = generateCalendarDays();
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];

            return (
                <div className="max-w-4xl mx-auto bg-white min-h-screen">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <Heart />
                                <div>
                                    <h1 className="text-3xl font-bold">Cycle Companion</h1>
                                    <p className="opacity-90">Supporting her through every phase</p>
                                </div>
                            </div>
                            <button
                                onClick={() => setShowSettings(!showSettings)}
                                className="p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all"
                            >
                                <Settings />
                            </button>
                        </div>
                    </div>

                    {/* Settings Panel */}
                    {showSettings && (
                        <div className="bg-gray-50 border-b p-6">
                            <h3 className="text-lg font-bold text-gray-800 mb-4">Settings</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Cycle Length (days)
                                    </label>
                                    <input
                                        type="number"
                                        min="21"
                                        max="35"
                                        value={tempSettings.cycleLength}
                                        onChange={(e) => setTempSettings(prev => ({
                                            ...prev,
                                            cycleLength: parseInt(e.target.value) || 28
                                        }))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Period Length (days)
                                    </label>
                                    <input
                                        type="number"
                                        min="3"
                                        max="8"
                                        value={tempSettings.periodLength}
                                        onChange={(e) => setTempSettings(prev => ({
                                            ...prev,
                                            periodLength: parseInt(e.target.value) || 5
                                        }))}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500"
                                    />
                                </div>
                                <div className="flex items-end gap-2">
                                    <button
                                        onClick={saveSettings}
                                        className="flex items-center gap-2 px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600"
                                    >
                                        <Save />
                                        Save Settings
                                    </button>
                                    <button
                                        onClick={exportData}
                                        className="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
                                    >
                                        Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Navigation */}
                    <div className="flex border-b">
                        <button
                            onClick={() => setActiveTab('calendar')}
                            className={`flex-1 py-4 px-6 flex items-center justify-center gap-2 font-medium ${
                                activeTab === 'calendar' 
                                    ? 'bg-pink-50 text-pink-600 border-b-2 border-pink-600' 
                                    : 'text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            <Calendar />
                            Calendar
                        </button>
                        <button
                            onClick={() => setActiveTab('insights')}
                            className={`flex-1 py-4 px-6 flex items-center justify-center gap-2 font-medium ${
                                activeTab === 'insights' 
                                    ? 'bg-pink-50 text-pink-600 border-b-2 border-pink-600' 
                                    : 'text-gray-600 hover:bg-gray-50'
                            }`}
                        >
                            <Info />
                            Insights
                        </button>
                    </div>

                    {activeTab === 'calendar' && (
                        <div className="p-6">
                            {/* Calendar Header */}
                            <div className="flex items-center justify-between mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">
                                    {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
                                </h2>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1))}
                                        className="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200"
                                    >
                                        ←
                                    </button>
                                    <button
                                        onClick={() => setCurrentDate(new Date())}
                                        className="px-4 py-2 bg-pink-100 text-pink-700 rounded-lg hover:bg-pink-200"
                                    >
                                        Today
                                    </button>
                                    <button
                                        onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1))}
                                        className="px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200"
                                    >
                                        →
                                    </button>
                                </div>
                            </div>

                            {/* Calendar Grid */}
                            <div className="grid grid-cols-7 gap-1 mb-6">
                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                    <div key={day} className="p-3 text-center font-semibold text-gray-600 bg-gray-50 rounded-lg">
                                        {day}
                                    </div>
                                ))}
                                
                                {calendarDays.map((date, index) => {
                                    if (!date) {
                                        return <div key={index} className="p-3 h-16"></div>;
                                    }
                                    
                                    const cycleInfo = getCycleInfo(date);
                                    const isToday = date.toDateString() === new Date().toDateString();
                                    const isSelected = selectedDate && date.toDateString() === selectedDate.toDateString();
                                    const dateKey = date.toISOString().split('T')[0];
                                    const hasNote = cycleData.notes[dateKey];
                                    
                                    return (
                                        <div
                                   
